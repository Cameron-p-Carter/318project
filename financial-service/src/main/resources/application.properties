package csci318.healthcare.financial;

import csci318.healthcare.financial.entity.Invoice;
import csci318.healthcare.financial.service.FinancialService;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.ApplicationContext;

import java.util.List;
import java.util.Scanner;

@SpringBootApplication
public class FinancialServiceApplication {
    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(FinancialServiceApplication.class, args);

        FinancialService service = context.getBean(FinancialService.class);

        Scanner scanner = new Scanner(System.in);
        boolean running = true;

        while (running) {
            System.out.println("\n=== Financial Service CLI ===");
            System.out.println("1. View all invoices");
            System.out.println("2. Claim insurance");
            System.out.println("3. Mark invoice as paid");
            System.out.println("4. Exit");
            System.out.print("Choose an option: ");

            String input = scanner.nextLine();
            switch (input) {
                case "1":
                    List<Invoice> invoices = service.getAllInvoices();
                    System.out.println("Invoices:");
                    invoices.forEach(inv -> System.out.println(
                        "ID: " + inv.getId() +
                        ", AppointmentID: " + inv.getAppointmentId() +
                        ", Patient: " + inv.getPatientName() +
                        ", Amount: " + inv.getAmount() +
                        ", Status: " + inv.getStatus() +
                        ", InsuranceClaimed: " + inv.isInsuranceClaimed()
                    ));
                    break;

                case "2":
                    System.out.print("Enter Invoice ID to claim insurance: ");
                    Long claimId = Long.parseLong(scanner.nextLine());
                    Invoice claimed = service.claimInsurance(claimId);
                    System.out.println("Insurance claimed for Invoice " + claimed.getId());
                    break;

                case "3":
                    System.out.print("Enter Invoice ID to mark as paid: ");
                    Long payId = Long.parseLong(scanner.nextLine());
                    Invoice paid = service.markPaid(payId);
                    System.out.println("Invoice " + paid.getId() + " marked as PAID");
                    break;

                case "4":
                    running = false;
                    System.out.println("Exiting CLI...");
                    break;

                default:
                    System.out.println("Invalid option, try again.");
            }
        }

        scanner.close();
    }
}
